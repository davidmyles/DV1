package ApplicationFiles;

import org.apache.commons.math3.linear.Array2DRowRealMatrix;
import org.apache.commons.math3.linear.RealMatrix;
import org.apache.commons.math3.linear.SingularValueDecomposition;

import java.awt.image.BufferedImage;
import java.io.IOException;
import java.sql.SQLException;
import java.util.Arrays;

public class IrisImageTrainer {

    static double [] d2;
    static ImageMatrix im;
    static Array2DRowRealMatrix baseMatrix;

    public static void runIrisImageTrainer1(int pixels, int images) {
        im = new ImageMatrix();
        im.CreateTrainingRealMatrix(pixels, (images+1));
        baseMatrix = im.getTrainingMatrix();
    }

    public static void runIrisImageTrainer2(String filepath, int width, int height, Array2DRowRealMatrix baseMatrix, int column) throws IOException {
        InputImage ii = new InputImage(filepath,width,height);
        BufferedImage bi = ii.getInputImage();
        RandomImage ri = new RandomImage();
        ImageMatrix im = new ImageMatrix();
        double [][] d1 = ii.createInputImageArray(bi);
        ri.flattenArray(d1);
        double [] d2 = ri.getFlatArray();
        im.populateTrainingMatrix(baseMatrix,d2,column);
    }


    public static void runIrisImageTrainer3(int pixels, int images) throws SQLException {
        ArrayProcessor ap = new ArrayProcessor();
        LinkSQL ls = new LinkSQL();
        ls.clearAvgValues();
        ls.clearPrincipleComponentsX2();
        ls.clearUnknownImageWeights();
        ls.clearWeights();
        ap.getAvgValues(baseMatrix,images);
        double[][] dx = ap.getArrayFromMatrix(baseMatrix);
        double [] dz = ap.getAvgValuesArray(dx);
        ls.savePixelAveragesToDB(dz);
        ap.applyAvgValues(baseMatrix);
        ap.finaliseAvgValues(baseMatrix);
        SVD svd = new SVD();
        double [][] d1 = ap.finaliseAvgValues(baseMatrix);
        im.CreateImageRealMatrix(d1);
        Array2DRowRealMatrix a2rrm = im.getTrainingMatrix();
        svd.CreateTrainingSVD(a2rrm);
        SingularValueDecomposition svd1 = svd.getTrainingSVD();
        RealMatrix r1 = svd1.getU();
        double[][] dc = ap.getArrayFromMatrix(r1);
        ls.savePrincipleComponentsToDB(dc);
        ap.createPCMatrix(pixels,(images*4));
        ap.calculateImageWeights(d1,r1,0, 0, 0);
        ap.calculateImageWeights(d1,r1,0, 1, 1);
        ap.calculateImageWeights(d1,r1,0, 2, 2);
        ap.calculateImageWeights(d1,r1,0, 3, 3);
        ap.calculateImageWeights(d1,r1,1, 0, 4);
        ap.calculateImageWeights(d1,r1,1, 1, 5);
        ap.calculateImageWeights(d1,r1,1, 2, 6);
        ap.calculateImageWeights(d1,r1,1, 3, 7);
        ap.calculateImageWeights(d1,r1,2, 0, 8);
        ap.calculateImageWeights(d1,r1,2, 1, 9);
        ap.calculateImageWeights(d1,r1,2, 2, 10);
        ap.calculateImageWeights(d1,r1,2, 3, 11);
        ap.calculateImageWeights(d1,r1,3, 0, 12);
        ap.calculateImageWeights(d1,r1,3, 1, 13);
        ap.calculateImageWeights(d1,r1,3, 2, 14);
        ap.calculateImageWeights(d1,r1,3, 3, 15);
        ap.calculateImageWeights(d1,r1,4, 0, 16);
        ap.calculateImageWeights(d1,r1,4, 1, 17);
        ap.calculateImageWeights(d1,r1,4, 2, 18);
        ap.calculateImageWeights(d1,r1,4, 3, 19);
        ap.calculateImageWeights(d1,r1,5, 0, 20);
        ap.calculateImageWeights(d1,r1,5, 1, 21);
        ap.calculateImageWeights(d1,r1,5, 2, 22);
        ap.calculateImageWeights(d1,r1,5, 3, 23);
        ap.calculateImageWeights(d1,r1,6, 0, 24);
        ap.calculateImageWeights(d1,r1,6, 1, 25);
        ap.calculateImageWeights(d1,r1,6, 2, 26);
        ap.calculateImageWeights(d1,r1,6, 3, 27);
        ap.calculateImageWeights(d1,r1,7, 0, 28);
        ap.calculateImageWeights(d1,r1,7, 1, 29);
        ap.calculateImageWeights(d1,r1,7, 2, 30);
        ap.calculateImageWeights(d1,r1,7, 3, 31);
        ap.calculateImageWeights(d1,r1,8, 0, 32);
        ap.calculateImageWeights(d1,r1,8, 1, 33);
        ap.calculateImageWeights(d1,r1,8, 2, 34);
        ap.calculateImageWeights(d1,r1,8, 3, 35);
        ap.calculateImageWeights(d1,r1,9, 0, 36);
        ap.calculateImageWeights(d1,r1,9, 1, 37);
        ap.calculateImageWeights(d1,r1,9, 2, 38);
        ap.calculateImageWeights(d1,r1,9, 3, 39);
        ap.calculateImageWeights(d1,r1,10, 0, 40);
        ap.calculateImageWeights(d1,r1,10, 1, 41);
        ap.calculateImageWeights(d1,r1,10, 2, 42);
        ap.calculateImageWeights(d1,r1,10, 3, 43);
        ap.calculateImageWeights(d1,r1,11, 0, 44);
        ap.calculateImageWeights(d1,r1,11, 1, 45);
        ap.calculateImageWeights(d1,r1,11, 2, 46);
        ap.calculateImageWeights(d1,r1,11, 3, 47);
        ap.calculateImageWeights(d1,r1,12, 0, 48);
        ap.calculateImageWeights(d1,r1,12, 1, 49);
        ap.calculateImageWeights(d1,r1,12, 2, 50);
        ap.calculateImageWeights(d1,r1,12, 3, 51);
        ap.calculateImageWeights(d1,r1,13, 0, 52);
        ap.calculateImageWeights(d1,r1,13, 1, 53);
        ap.calculateImageWeights(d1,r1,13, 2, 54);
        ap.calculateImageWeights(d1,r1,13, 3, 55);
        ap.calculateImageWeights(d1,r1,14, 0, 56);
        ap.calculateImageWeights(d1,r1,14, 1, 57);
        ap.calculateImageWeights(d1,r1,14, 2, 58);
        ap.calculateImageWeights(d1,r1,14, 3, 59);
        ap.calculateImageWeights(d1,r1,15, 0, 60);
        ap.calculateImageWeights(d1,r1,15, 1, 61);
        ap.calculateImageWeights(d1,r1,15, 2, 62);
        ap.calculateImageWeights(d1,r1,15, 3, 63);
        ap.calculateImageWeights(d1,r1,16, 0, 64);
        ap.calculateImageWeights(d1,r1,16, 1, 65);
        ap.calculateImageWeights(d1,r1,16, 2, 66);
        ap.calculateImageWeights(d1,r1,16, 3, 67);
        ap.calculateImageWeights(d1,r1,17, 0, 68);
        ap.calculateImageWeights(d1,r1,17, 1, 69);
        ap.calculateImageWeights(d1,r1,17, 2, 70);
        ap.calculateImageWeights(d1,r1,17, 3, 71);
        ap.calculateImageWeights(d1,r1,18, 0, 72);
        ap.calculateImageWeights(d1,r1,18, 1, 73);
        ap.calculateImageWeights(d1,r1,18, 2, 74);
        ap.calculateImageWeights(d1,r1,18, 3, 75);
        ap.calculateImageWeights(d1,r1,19, 0, 76);
        ap.calculateImageWeights(d1,r1,19, 1, 77);
        ap.calculateImageWeights(d1,r1,19, 2, 78);
        ap.calculateImageWeights(d1,r1,19, 3, 79);
        ap.calculateImageWeights(d1,r1,20, 0, 80);
        ap.calculateImageWeights(d1,r1,20, 1, 81);
        ap.calculateImageWeights(d1,r1,20, 2, 82);
        ap.calculateImageWeights(d1,r1,20, 3, 83);
        ap.calculateImageWeights(d1,r1,21, 0, 84);
        ap.calculateImageWeights(d1,r1,21, 1, 85);
        ap.calculateImageWeights(d1,r1,21, 2, 86);
        ap.calculateImageWeights(d1,r1,21, 3, 87);
        ap.calculateImageWeights(d1,r1,22, 0, 88);
        ap.calculateImageWeights(d1,r1,22, 1, 89);
        ap.calculateImageWeights(d1,r1,22, 2, 90);
        ap.calculateImageWeights(d1,r1,22, 3, 91);
        ap.calculateImageWeights(d1,r1,23, 0, 92);
        ap.calculateImageWeights(d1,r1,23, 1, 93);
        ap.calculateImageWeights(d1,r1,23, 2, 94);
        ap.calculateImageWeights(d1,r1,23, 3, 95);
        ap.calculateImageWeights(d1,r1,24, 0, 96);
        ap.calculateImageWeights(d1,r1,24, 1, 97);
        ap.calculateImageWeights(d1,r1,24, 2, 98);
        ap.calculateImageWeights(d1,r1,24, 3, 99);
        ap.calculateImageWeights(d1,r1,25, 0, 100);
        ap.calculateImageWeights(d1,r1,25, 1, 101);
        ap.calculateImageWeights(d1,r1,25, 2, 102);
        ap.calculateImageWeights(d1,r1,25, 3, 103);
        ap.calculateImageWeights(d1,r1,26, 0, 104);
        ap.calculateImageWeights(d1,r1,26, 1, 105);
        ap.calculateImageWeights(d1,r1,26, 2, 106);
        ap.calculateImageWeights(d1,r1,26, 3, 107);
        ap.calculateImageWeights(d1,r1,27, 0, 108);
        ap.calculateImageWeights(d1,r1,27, 1, 109);
        ap.calculateImageWeights(d1,r1,27, 2, 110);
        ap.calculateImageWeights(d1,r1,27, 3, 111);
        ap.calculateImageWeights(d1,r1,28, 0, 112);
        ap.calculateImageWeights(d1,r1,28, 1, 113);
        ap.calculateImageWeights(d1,r1,28, 2, 114);
        ap.calculateImageWeights(d1,r1,28, 3, 115);
        ap.calculateImageWeights(d1,r1,29, 0, 116);
        ap.calculateImageWeights(d1,r1,29, 1, 117);
        ap.calculateImageWeights(d1,r1,29, 2, 118);
        ap.calculateImageWeights(d1,r1,29, 3, 119);
        ap.calculateImageWeights(d1,r1,30, 0, 120);
        ap.calculateImageWeights(d1,r1,30, 1, 121);
        ap.calculateImageWeights(d1,r1,30, 2, 122);
        ap.calculateImageWeights(d1,r1,30, 3, 123);
        ap.calculateImageWeights(d1,r1,31, 0, 124);
        ap.calculateImageWeights(d1,r1,31, 1, 125);
        ap.calculateImageWeights(d1,r1,31, 2, 126);
        ap.calculateImageWeights(d1,r1,31, 3, 127);
        ap.calculateImageWeights(d1,r1,32, 0, 128);
        ap.calculateImageWeights(d1,r1,32, 1, 129);
        ap.calculateImageWeights(d1,r1,32, 2, 130);
        ap.calculateImageWeights(d1,r1,32, 3, 131);
        ap.calculateImageWeights(d1,r1,33, 0, 132);
        ap.calculateImageWeights(d1,r1,33, 1, 133);
        ap.calculateImageWeights(d1,r1,33, 2, 134);
        ap.calculateImageWeights(d1,r1,33, 3, 135);
        ap.calculateImageWeights(d1,r1,34, 0, 136);
        ap.calculateImageWeights(d1,r1,34, 1, 137);
        ap.calculateImageWeights(d1,r1,34, 2, 138);
        ap.calculateImageWeights(d1,r1,34, 3, 139);
        ap.calculateImageWeights(d1,r1,35, 0, 140);
        ap.calculateImageWeights(d1,r1,35, 1, 141);
        ap.calculateImageWeights(d1,r1,35, 2, 142);
        ap.calculateImageWeights(d1,r1,35, 3, 143);
        ap.calculateImageWeights(d1,r1,36, 0, 144);
        ap.calculateImageWeights(d1,r1,36, 1, 145);
        ap.calculateImageWeights(d1,r1,36, 2, 146);
        ap.calculateImageWeights(d1,r1,36, 3, 147);
        ap.calculateImageWeights(d1,r1,37, 0, 148);
        ap.calculateImageWeights(d1,r1,37, 1, 149);
        ap.calculateImageWeights(d1,r1,37, 2, 150);
        ap.calculateImageWeights(d1,r1,37, 3, 151);
        ap.calculateImageWeights(d1,r1,38, 0, 152);
        ap.calculateImageWeights(d1,r1,38, 1, 153);
        ap.calculateImageWeights(d1,r1,38, 2, 154);
        ap.calculateImageWeights(d1,r1,38, 3, 155);
        ap.calculateImageWeights(d1,r1,39, 0, 156);
        ap.calculateImageWeights(d1,r1,39, 1, 157);
        ap.calculateImageWeights(d1,r1,39, 2, 158);
        ap.calculateImageWeights(d1,r1,39, 3, 159);
        ap.calculateImageWeights(d1,r1,40, 0, 160);
        ap.calculateImageWeights(d1,r1,40, 1, 161);
        ap.calculateImageWeights(d1,r1,40, 2, 162);
        ap.calculateImageWeights(d1,r1,40, 3, 163);
        ap.calculateImageWeights(d1,r1,41, 0, 164);
        ap.calculateImageWeights(d1,r1,41, 1, 165);
        ap.calculateImageWeights(d1,r1,41, 2, 166);
        ap.calculateImageWeights(d1,r1,41, 3, 167);
        ap.calculateImageWeights(d1,r1,42, 0, 168);
        ap.calculateImageWeights(d1,r1,42, 1, 169);
        ap.calculateImageWeights(d1,r1,42, 2, 170);
        ap.calculateImageWeights(d1,r1,42, 3, 171);
        ap.calculateImageWeights(d1,r1,43, 0, 172);
        ap.calculateImageWeights(d1,r1,43, 1, 173);
        ap.calculateImageWeights(d1,r1,43, 2, 174);
        ap.calculateImageWeights(d1,r1,43, 3, 175);
        ap.calculateImageWeights(d1,r1,44, 0, 176);
        ap.calculateImageWeights(d1,r1,44, 1, 177);
        ap.calculateImageWeights(d1,r1,44, 2, 178);
        ap.calculateImageWeights(d1,r1,44, 3, 179);
        ap.calculateImageWeights(d1,r1,45, 0, 180);
        ap.calculateImageWeights(d1,r1,45, 1, 181);
        ap.calculateImageWeights(d1,r1,45, 2, 182);
        ap.calculateImageWeights(d1,r1,45, 3, 183);
        ap.calculateImageWeights(d1,r1,46, 0, 184);
        ap.calculateImageWeights(d1,r1,46, 1, 185);
        ap.calculateImageWeights(d1,r1,46, 2, 186);
        ap.calculateImageWeights(d1,r1,46, 3, 187);
        ap.calculateImageWeights(d1,r1,47, 0, 188);
        ap.calculateImageWeights(d1,r1,47, 1, 189);
        ap.calculateImageWeights(d1,r1,47, 2, 190);
        ap.calculateImageWeights(d1,r1,47, 3, 191);
        ap.calculateImageWeights(d1,r1,48, 0, 192);
        ap.calculateImageWeights(d1,r1,48, 1, 193);
        ap.calculateImageWeights(d1,r1,48, 2, 194);
        ap.calculateImageWeights(d1,r1,48, 3, 195);
        ap.calculateImageWeights(d1,r1,49, 0, 196);
        ap.calculateImageWeights(d1,r1,49, 1, 197);
        ap.calculateImageWeights(d1,r1,49, 2, 198);
        ap.calculateImageWeights(d1,r1,49, 3, 199);
        ap.calculateImageWeights(d1,r1,50, 0, 200);
        ap.calculateImageWeights(d1,r1,50, 1, 201);
        ap.calculateImageWeights(d1,r1,50, 2, 202);
        ap.calculateImageWeights(d1,r1,50, 3, 203);
        ap.calculateImageWeights(d1,r1,51, 0, 204);
        ap.calculateImageWeights(d1,r1,51, 1, 205);
        ap.calculateImageWeights(d1,r1,51, 2, 206);
        ap.calculateImageWeights(d1,r1,51, 3, 207);
        ap.calculateImageWeights(d1,r1,52, 0, 208);
        ap.calculateImageWeights(d1,r1,52, 1, 209);
        ap.calculateImageWeights(d1,r1,52, 2, 210);
        ap.calculateImageWeights(d1,r1,52, 3, 211);
        ap.calculateImageWeights(d1,r1,53, 0, 212);
        ap.calculateImageWeights(d1,r1,53, 1, 213);
        ap.calculateImageWeights(d1,r1,53, 2, 214);
        ap.calculateImageWeights(d1,r1,53, 3, 215);
        ap.calculateImageWeights(d1,r1,54, 0, 216);
        ap.calculateImageWeights(d1,r1,54, 1, 217);
        ap.calculateImageWeights(d1,r1,54, 2, 218);
        ap.calculateImageWeights(d1,r1,54, 3, 219);
        ap.calculateImageWeights(d1,r1,55, 0, 220);
        ap.calculateImageWeights(d1,r1,55, 1, 221);
        ap.calculateImageWeights(d1,r1,55, 2, 222);
        ap.calculateImageWeights(d1,r1,55, 3, 223);
        ap.calculateImageWeights(d1,r1,56, 0, 224);
        ap.calculateImageWeights(d1,r1,56, 1, 225);
        ap.calculateImageWeights(d1,r1,56, 2, 226);
        ap.calculateImageWeights(d1,r1,56, 3, 227);
        ap.calculateImageWeights(d1,r1,57, 0, 228);
        ap.calculateImageWeights(d1,r1,57, 1, 229);
        ap.calculateImageWeights(d1,r1,57, 2, 230);
        ap.calculateImageWeights(d1,r1,57, 3, 231);
        ap.calculateImageWeights(d1,r1,58, 0, 232);
        ap.calculateImageWeights(d1,r1,58, 1, 233);
        ap.calculateImageWeights(d1,r1,58, 2, 234);
        ap.calculateImageWeights(d1,r1,58, 3, 235);
        ap.calculateImageWeights(d1,r1,59, 0, 236);
        ap.calculateImageWeights(d1,r1,59, 1, 237);
        ap.calculateImageWeights(d1,r1,59, 2, 238);
        ap.calculateImageWeights(d1,r1,59, 3, 239);
        RealMatrix r2 = ap.getPCMatrix();
        double[][] d5 = ap.createWeightsArray(r2);
        ap.createWeightsTable(d5,4);
        double [][] d6 = ap.getWeightsTable();
        System.out.println("Weights: " + Arrays.deepToString(d6));
        ls.saveWeightsTableToDB(d6);
    }

    public static void main(String args[]) throws SQLException, IOException {
        runIrisImageTrainer1(2500, 9);
        runIrisImageTrainer2("/Users/davidjmyles/IdeaProjects/DV1/trainingimages3/img_01.png", 50,50, baseMatrix, 0);
        runIrisImageTrainer2("/Users/davidjmyles/IdeaProjects/DV1/trainingimages3/img_02.png", 50,50, baseMatrix, 1);
        runIrisImageTrainer2("/Users/davidjmyles/IdeaProjects/DV1/trainingimages3/img_03.png", 50,50, baseMatrix, 2);
        runIrisImageTrainer2("/Users/davidjmyles/IdeaProjects/DV1/trainingimages3/img_04.png", 50,50, baseMatrix, 3);
        runIrisImageTrainer2("/Users/davidjmyles/IdeaProjects/DV1/trainingimages3/img_05.png", 50,50, baseMatrix, 4);
        runIrisImageTrainer2("/Users/davidjmyles/IdeaProjects/DV1/trainingimages3/img_06.png", 50,50, baseMatrix, 5);
        runIrisImageTrainer2("/Users/davidjmyles/IdeaProjects/DV1/trainingimages3/img_07.png", 50,50, baseMatrix, 6);
        runIrisImageTrainer2("/Users/davidjmyles/IdeaProjects/DV1/trainingimages3/img_08.png", 50,50, baseMatrix, 7);
        runIrisImageTrainer2("/Users/davidjmyles/IdeaProjects/DV1/trainingimages3/img_09.png", 50,50, baseMatrix, 8);
        runIrisImageTrainer3(2500,9);
    }


}
